<!DOCTYPE html>
<html>
<head>
    <title>Cadastrar Eventos</title>
    <!-- Incluindo o Bootstrap CSS via CDN -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Cadastrar Eventos</h1>
        <ul>
            {% for evento in eventos %}
            <li>{{ evento.nome_evento }} - {{ evento.data_evento }}</li>
            {% endfor %}
        </ul>

        <h2>Adicionar Novo Evento</h2>
        <form id="formEvento">
            <div class="form-group">
                <label for="nome_evento">Nome do Evento:</label>
                <input type="text" class="form-control" id="nome_evento" name="nome_evento" required>
            </div>

            <div class="form-group">
                <label for="data_evento">Data do Evento:</label>
                <input type="date" class="form-control" id="data_evento" name="data_evento" required>
            </div>

            <div class="form-group">
                <label for="descricao">Descrição:</label>
                <textarea class="form-control" id="descricao" name="descricao" required></textarea>
            </div>

            <div class="form-group">
                <label for="localizacao">Localização:</label>
                <input type="text" class="form-control" id="localizacao" name="localizacao" required>
            </div>

            <button type="submit" class="btn btn-primary">Adicionar Evento</button>

            <!-- Botão para voltar para a página inicial (index.html) -->
            <a href="/" class="btn btn-secondary ml-2">Voltar para a Página Inicial</a>
        </form>

        <div id="mensagem"></div>
    </div>

    <!-- Incluindo o jQuery via CDN -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Incluindo o Bootstrap JS via CDN -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function() {
            // Submeter formulário para adicionar novo evento
            $('#formEvento').submit(function(e) {
                e.preventDefault();
                var formData = {
                    nome_evento: $('#nome_evento').val(),
                    data_evento: $('#data_evento').val(),
                    descricao: $('#descricao').val(),
                    localizacao: $('#localizacao').val()
                };

                $.ajax({
                    type: 'POST',
                    url: '/api/eventos',  // Alterado para a rota correta do Flask
                    contentType: 'application/json',  // Tipo de conteúdo para dados JSON
                    data: JSON.stringify(formData),  // Enviar dados como JSON
                    success: function(response) {
                        $('#mensagem').text(response.message);
                        $('#nome_evento, #data_evento, #descricao, #localizacao').val('');
                        // Redirecionar para a página inicial para ver a lista de eventos atualizada
                        window.location.href = '/';
                    },
                    error: function(xhr, status, error) {
                        console.error('Erro ao adicionar evento:', error);
                        $('#mensagem').text('Erro ao adicionar evento. Verifique o console para mais detalhes.');
                    }
                });
            });
        });
    </script>
</body>
</html>
